<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Scada控制台</title>
    <link rel="stylesheet" type="text/css" href="Css/identify.css"/>
    <link rel="stylesheet" type="text/css" href="Css/layout.css"/>
    <link rel="stylesheet" type="text/css" href="Css/account.css"/>
    <link rel="stylesheet" type="text/css" href="Css/style.css"/>
    <link rel="stylesheet" type="text/css" href="Css/control_index.css"/>
    <link rel="stylesheet" href="Css/plugins/animate.min.css">
    <script type="text/javascript" src="Js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="Js/layer/layer.js"></script>
    <script type="text/javascript" src="Js/haidao.offcial.general.js"></script>
    <script type="text/javascript" src="Js/select.js"></script>
    <script type="text/javascript" src="Js/haidao.validate.js"></script>
</head>

<body>
<div class="view-topbar">
    <div class="topbar-console">
        <div class="tobar-head fl">
            <a href="#" class="topbar-logo fl">
                <span><img src="Images/logo.png" width="20" height="20"/></span>
            </a>
            <a href="#" class="topbar-home-link topbar-btn text-center fl"><span>Scada控制台</span></a>
        </div>
    </div>
    <div class="topbar-info">
        <ul class="fr">

            <li class="fl topbar-info-item">
                <div class="">
                    <a href="#" id="openepwdedit" class="topbar-btn">
                        <span class="fl text-normal">修改密码</span>
                    </a>
                </div>
            </li>
            <li class="fl topbar-info-item">
                <div>
                    <a href="#" onclick="changePage('/user')" class="topbar-btn">
                        <span class="fl text-normal">#(user.nick_name)</span>
                        <span class="icon-arrow-down"></span>
                    </a>
                </div>
            </li>
            <li class="fl topbar-info-item">
                <div class="">
                    <a href="/exit" class="topbar-btn">
                        <span class="fl text-normal">退出</span>
                        <span class="icon-arrow-down"></span>
                    </a>
                </div>
            </li>
        </ul>
    </div>
</div>
<div class="view-body">
    <div class="view-sidebar">
        <div class="sidebar-content">
            #if (user.rid == 1)
            <div class="sidebar-nav">
                <div class="sidebar-title">
                    <a href="#">
                        <span class="icon"><b class="fl icon-arrow-down"></b></span>
                        <span class="text-normal">管理员菜单</span>
                    </a>
                </div>
                <ul class="sidebar-trans">
                    <!--<li>-->
                        <!--<a href="webSet.html">-->
                            <!--<b class="sidebar-icon"><img src="Images/icon_author.png" width="16" height="16"/></b>-->
                            <!--<span class="text-normal">角色管理</span>-->
                        <!--</a>-->
                    <!--</li>-->
                    <li>
                        <a href="#" onclick="changePage('/admin/userlist')">
                            <b class="sidebar-icon"><img src="Images/icon_message.png" width="16" height="16"/></b>
                            <span class="text-normal">用户管理</span>
                        </a>
                    </li>
                </ul>
            </div>
            #end

            <div class="sidebar-nav">
                <div class="sidebar-title">
                    <a href="#">
                        <span class="icon"><b class="fl icon-arrow-down"></b></span>
                        <span class="text-normal">我的SCADA</span>
                    </a>
                </div>
                <ul class="sidebar-trans">
                    <li>
                        <a href="#" onclick="changePage('server/scadalist')">
                            <b class="sidebar-icon"><img src="Images/icon_author.png" width="16" height="16"/></b>
                            <span class="text-normal">scada列表</span>
                        </a>
                    </li>
                    <li>
                        <a href="/server" target="_blank">
                            <b class="sidebar-icon"><img src="Images/icon_message.png" width="16" height="16"/></b>
                            <span class="text-normal">编辑器</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="sidebar-nav">
                <div class="sidebar-title">
                    <a href="#">
                        <span class="icon"><b class="fl icon-arrow-down"></b></span>
                        <span class="text-normal">账号菜单</span>
                    </a>
                </div>
                <ul class="sidebar-trans">
                    <li>
                        <a href="#" onclick="changePage('/user')">
                            <b class="sidebar-icon"><img src="Images/icon_cost.png" width="16" height="16"/></b>
                            <span class="text-normal">账号管理</span>
                        </a>
                    </li>
                    <!--<li>-->
                        <!--<a href="message.html">-->
                            <!--<b class="sidebar-icon"><img src="Images/icon_news.png" width="16" height="16"/></b>-->
                            <!--<span class="text-normal">我的权限</span>-->
                        <!--</a>-->
                    <!--</li>-->
                </ul>
            </div>
        </div>
    </div>
    <div class="view-product background-color">
        <div class="padding-big background-color" id="mycontent">
        </div>
    </div>
</div>
<div id="pwdBox" style="display: none;">
    <form id="pwdEidtForm" onsubmit="return false">
        <table class="table table-bordered table-hover">
            <tr>
                <th style="width: 80px">旧密码</th>
                <td><input name="oldpwd" class="input input-small" type="password" placeholder="请输入旧密码"/></td>
            </tr>
            <tr>
                <th>新密码</th>
                <td><input name="newpwd" name="nick_name" class="input input-small" type="password"
                           placeholder="请输入新密码"/>
                </td>
            </tr>
            <tr>
                <th>重新输入</th>
                <td><input name="repwd" class="input input-small" type="password" placeholder="请重新输入新密码"/></td>
            </tr>
            <tr>
                <td colspan="2">
                    <button type="button" onclick="updatePwd()"
                            class="button submitBtn button-full btn-orange text-white">确认修改
                    </button>
                </td>
            </tr>
        </table>
    </form>
</div>

<script type="text/javascript" src="Js/sidebar.js"></script>
<script type="text/javascript" src="Js/plugins/jquery.hDialog.min.js"></script>
<script>
    ;(function () {
        $('#openepwdedit').hDialog({resetForm: false, box: "#pwdBox", title: '密码修改', height: 300});
        window.updatePwd = () => {
            let d = {};
            let t = $('#pwdEidtForm').serializeArray();
            $.each(t, function () {
                d[this.name] = this.value;
            });
            if (d["oldpwd"] === '' || d["newpwd"] === '' || d["repwd"] === '') {
                $.tooltip('请将密码填写完整1');
            } else if (d["oldpwd"].length < 6 || d["newpwd"].length < 6) {
                $.tooltip('密码长度必须大于6!');
            } else if (d["repwd"] != d["newpwd"]) {
                $.tooltip('两次密码输入不一致!!');
            } else {
                $.post("/user/updatepwd", d, function (e) {
                        //location.href = "/";
                        if (e == true) {
                            $.tooltip('修改成功～', 2000, true, function () {
                            });
                            $("#pwdBox").hide();
                            $(".openedit").hDialog('close', {box: '#pwdBox'});
                        } else {
                            $.tooltip("旧密码错误!");
                        }
                    }, 'json'
                );

            }
        }
    })();


    $(".sidebar-title").live('click', function () {
        if ($(this).parent(".sidebar-nav").hasClass("sidebar-nav-fold")) {
            $(this).next().slideDown(200);
            $(this).parent(".sidebar-nav").removeClass("sidebar-nav-fold");
        } else {
            $(this).next().slideUp(200);
            $(this).parent(".sidebar-nav").addClass("sidebar-nav-fold");
        }
    });
</script>
</body>

</html>